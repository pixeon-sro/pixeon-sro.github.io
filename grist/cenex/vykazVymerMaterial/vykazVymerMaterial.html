<!DOCTYPE html>
<html lang="sk">
  <head>
    <meta charset="utf-8">
    <title>Výkaz výmer materiál</title>
    <link href="./style.css" rel="stylesheet" />
    <link href="./stylePrinter.css" rel="stylesheet" media="print" />
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  </head>
  <body>
    <h1>Výkaz výmer materiál</h1>
    
    <pre id="myDisplay" style="background:red"></pre>
    
    <table id="dataTable">
      <tr>
        <th>Etapa</th>
        <th>Materiál</th>
        <th>Jednotka</th>
        <th>Jednotková cena</th>
        <th>Množstvo</th>
        <th>Celková cena</th>
      </tr>
    </table>
    <!-- vynutene zalomenie strany pri tlaci  -->
    <div style="break-after:page"></div>
    
    <script>
      console.log("*** ver: 051");

      // pomocna funkcia na zobrazenie premennych
      let myDisplay = function(zobraz) {
        document.getElementById("myDisplay").innerText = zobraz;
      }

      //nacitanie dat z tabulky
      /*function loadData (data) {
        let $dataFromTable = {}
        Object.assign($dataFromTable)
        return dataFromTable;
      };*/
      
      /*function showTable(data) {
        if (data === null) {
          throw new Error("No data");
        }
        else {
          // urcenie cielovej tabulky
          let table = document.getElementById("dataTable");
          
          data.forEach(function(row) {
            //
            let tr = table.insertRow(-1);
            
            let td1 = tr.insertCell(0);
            td1.innerHTML = row.etapa;
            
            let td2 = tr.insertCell(1);
            td2.innerHTML = row.material;
            
            let td3 = tr.insertCell(2);
            td3.innerHTML = row.jednotka;
            
            let td4 = tr.insertCell(3);
            td4.innerHTML = row.jednotkova_cena;
            
            let td5 = tr.insertCell(4);
            td5.innerHTML = row.mnozstvo;
            
            let td6 = tr.insertCell(5);
            td6.innerHTML = row.celkova_cena.toFixed(2);
          });
        }
      };*/

      // grist pozaduje pristu na čítanie tabulky
      grist.ready({ requiredAccess: 'read' })
      
      // nacitanie tabulky grist
      async function dataFromCenex() {
        return await grist.docApi.fetchSelectedTable(options = {format:"rows"})
      }
      
      //let $dataToPrint = dataFroCenex.then()
      
      // pomocne zobrazenia
      myDisplay(dataFromCenex())
      console.log(dataFromCenex())
    </script>
    
    <button onclick="window.print()">Tlačiť</button>
  </body>
</html>
