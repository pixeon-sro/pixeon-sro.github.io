<!DOCTYPE html>
<html lang="sk">
  <head>
    <meta charset="utf-8">
    <title>Výkaz cenová ponuka</title>
    <link href="../css/style.css" rel="stylesheet" />
    <link href="../css/stylePrinter.css" rel="stylesheet" media="print" />
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <script src="dataCP.js"></script>
  </head>
  <body>
    <pre id="myDisplay" style="background:red"></pre>

    <h1>Cenová ponuka</h1>
    <h2><strong>Dielo: </strong><span id="dielo"></span></h2>
    <h2><strong>Investor: </strong><span id="zakaznik"></span></h2>
    <h3>Kontaktné údaje</h3>
    <p>
      <strong>telefón: </strong><span id="telefon"></span><br/>
      <strong>e-mail: </strong><span id="mail"></span>
    </p>
    <p>
      <strong>Dátum vyhotovenia CP: </strong><span id="datumVytvorenia"></span><br/>
      <strong>Dátum platnosti CP: </strong><span id="datumPlatnosti"></span>
    </p>

    <h1>Výkaz Materiálu</h1>

    <table id="material">
      <tr>
        <th>Etapa</th>
        <th>Materiál</th>
        <th>Jednotka</th>
        <th>Jednotková cena</th>
        <th>Množstvo</th>
        <th>Celková cena</th>
      </tr>
    </table>
    <!-- vynutene zalomenie strany pri tlaci  -->
    <div style="break-after:page"></div>

    <script>
    //verzia scriptu do konzoly
    console.log("*** vykazCenovaPonuka.html - ver: 028")

    /*
    /  vytvorenie CP
    /  promise object dataCP je vytvorený
    /  volaním funkcie dataFromCP z dataCP.js
    */
    let dataCP = dataFromCP()
    dataCP.then(
      function(value) { cp(value) },
      function(error) { console.log(error) }
    )

    //vytvorenie poľa objektov pre tlačové tabuľky
    function cp(value) {
      let ref = value[0]
      /*
      // dataCP obsahuje object References
      // ten zahŕňa všetky referancie na potrebné tabuľky
      // najskôr sa References rozobere na jedntlive tabuľky
      // a potom sa doplnia údajmi
      */
      console.log(ref)
      let refVMaterial = ref.References.Vykaz_Vymer_Material
      let refVPraca = ref.References.Vykaz_Vymer_Praca
      let refVNaklady = ref.References.Pridruzene_naklady
      let refVCena = ref.References.Konecna_Cena
      let refVEtapa = ref.References.Etapa

      // funkcia doplňujúca údajov z tabuľky materiálov
      function createVMaterial(){
        let vMaterial = []
        refVMaterial.forEach(function(row) {
          console.log(row)
          let element = {
            id:row.id,
            jednotka:row.jednotka,
            jednotkova_cena:row.jednotkova_cena,
            mnozstvo:row.mnozstvo,
            celkova_cena:row.celkova_cena
          }
          //doplnenie etapy
          console.log(tableEtapa)
          tableEtapa.forEach((item) => {
            console.log(item)
            if (item.id == row.etapa.rovId) {
              element:etapa = item.etapa
            }
          })
          vMaterial.push(element)
        })
      console.log("hotovy material:")
      console.log(vMaterial)
      }

      // vytvorenie tabuliek pre tlac
      let vykazVymerMaterial = createVMaterial()


      function vykazVymerPraca(){return praca}
      function vykazPridruzeneNaklady(){return naklady}
      function vykazKonecnaCena(){return cena}
      function vykazEtapa(){return etapa}
    }
    </script>

    <button onclick="window.print()">Tlačiť</button>
  </body>
</html>
