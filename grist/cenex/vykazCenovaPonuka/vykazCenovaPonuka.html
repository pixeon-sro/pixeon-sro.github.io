<!DOCTYPE html>
<html lang="sk">
  <head>
    <meta charset="utf-8">
    <title>Výkaz cenová ponuka</title>
    <link href="../css/style.css" rel="stylesheet" />
    <link href="../css/stylePrinter.css" rel="stylesheet" media="print" />
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <!--<script src="-cp.js"></script>-->
    <script src="cp-example.js"></script>
  </head>
  <body>  
    <pre id="myDisplay" style="background:red"></pre>
    
    <h1>Cenová ponuka</h1>
    <h2><strong>Dielo: </strong><span id="dielo"></span></h2>
    <h2><strong>Investor: </strong><span id="zakaznik"></span></h2>
    <h3>Kontaktné údaje</h3>
    <p>
      <strong>telefón: </strong><span id="telefon"></span><br/>
      <strong>e-mail: </strong><span id="mail"></span>
    </p>
    <p>
      <strong>Dátum vyhotovenia CP: </strong><span id="datumVytvorenia"></span><br/>
      <strong>Dátum platnosti CP: </strong><span id="datumPlatnosti"></span>
    </p>
    
    <h1>Výkaz Materiálu</h1>
    
    <table id="VykazVymerMaterial">
      <tr>
        <th>Etapa</th>
        <th>Materiál</th>
        <th>Jednotka</th>
        <th>Jednotková cena</th>
        <th>Množstvo</th>
        <th>Celková cena</th>
      </tr>
    </table>
    <!-- vynutene zalomenie strany pri tlaci  -->
    <div style="break-after:page"></div>
    
    <script>
    //verzia scriptu do konzoly
    console.log("*** vykazCenovaPonuka.html - ver: 026")
    
      // pomocná funkcia na zobrazenie premenných pri vývoji
      let myDisplay = function(zobraz) {
        document.getElementById("myDisplay").innerText = zobraz;
      }



//verzia scriptu do konzoly
console.log("*** cp.js - ver: 036")
      
// grist požaduje plný prístup
grist.ready({ requiredAccess: 'full' })

// načítanie tabuľky grist
async function dataFromCenex() {
    let dataFromCenex = await grist.docApi.fetchSelectedTable(options = {format:"rows"})
    return dataFromCenex
}

// vytvorenie objektu z načítaných dát
let data = dataFromCenex()
data.then(
    function(value) { tabData(value) },
    function(error) { console.log(error) }
)

function toRecordMap(columnData) {
  const fieldNames = Object.keys(columnData)
  return new Map(columnData.id.map((id, index) => {
    const values = fieldNames.map(col => [col, columnData[col][index]])
    return [id, Object.fromEntries(values)]
  }))
}

const m = await grist.docApi.fetchTable("Etapa")
console.log(m)

    </script>
    
    <button onclick="window.print()">Tlačiť</button>
  </body>
</html>
