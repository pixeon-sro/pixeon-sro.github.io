<!DOCTYPE html>
<html lang="sk">
  <head>
    <meta charset="utf-8">
    <title>Výkaz cenová ponuka</title>
    <link href="../css/style.css" rel="stylesheet" />
    <link href="../css/stylePrinter.css" rel="stylesheet" media="print" />
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  </head>
  <body>
    <h1>Cenová ponuka</h1>
    <hr/>
    <h2><strong>Dielo: </strong><span id="dielo"></span></h2>
    <h2><strong>Investor: </strong><span id="zakaznik"></span></h2>
    <h3>Kontaktné údaje</h3>
    <div>
      <strong>telefón: </strong><span id="telefon"></span><br/>
      <strong>e-mail: </strong><span id="mail"></span>
    </div>
    <hr/>
    <div>
      <strong>Dátum vyhotovenia CP: </strong><span id="datum-vyhotovenia"></span><br/>
      <strong>Dátum platnosti CP: </strong><span id="datum-platnosti"></span>
    </div>
    
    <table id="dataTable">
      <tr>
        <th>Etapa</th>
        <th>Materiál</th>
        <th>Jednotka</th>
        <th>Jednotková cena</th>
        <th>Množstvo</th>
        <th>Celková cena</th>
      </tr>
    </table>
    <!-- vynutene zalomenie strany pri tlaci  -->
    <div style="break-after:page"></div>
    
    <script>
      console.log("*** ver: 002")

      // pomocná funkcia na zobrazenie premenných pri vývoji
      
      let myDisplay = function(zobraz) {
        document.getElementById("myDisplay").innerText = zobraz;
      }
      
      
      function printTable(data) {
      
      // pomocne zobrazenia
      myDisplay(data)

        if (data === null) {
          throw new Error("No data")
        }
        else {
          // urcenie cielovej tabulky
          let table = document.getElementById("dataTable")
          
          data.forEach(function(row) {
            
            let tr = table.insertRow(-1)
            
            let td1 = tr.insertCell(0)
            td1.innerHTML = row.etapa
            
            let td2 = tr.insertCell(1)
            td2.innerHTML = row.material
            
            let td3 = tr.insertCell(2)
            td3.innerHTML = row.jednotka
            
            let td4 = tr.insertCell(3)
            td4.innerHTML = row.jednotkova_cena
            
            let td5 = tr.insertCell(4)
            td5.innerHTML = row.mnozstvo
            
            let td6 = tr.insertCell(5)
            td6.innerHTML = row.celkova_cena.toFixed(2)
          })
        }
      }

      // grist požaduje prístu na čítanie tabuľky
      grist.ready({ requiredAccess: 'full' })
      
      // načítanie tabuľky grist
      async function dataFromCenex() {
        let $dataFromCenex = await grist.docApi.fetchSelectedTable(options = {format:"rows"})
        return $dataFromCenex
      }
      
      let dataToPrint = dataFromCenex()
      dataToPrint.then(
        function(value) { printTable(value) },
        function(error) { console.log(error) }
      )
      
    </script>
    
    <button onclick="window.print()">Tlačiť</button>
  </body>
</html>
